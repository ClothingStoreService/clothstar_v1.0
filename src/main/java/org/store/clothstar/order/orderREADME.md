# order 패키지 README

## 패키지 개요

이 패키지는 주문에 대한 기능을 구현하기 위한 패키지이다(v1).

### 주문 생성 설계안

1. 주문 유효성 검사
    - 주문 생성시 재고 수량이 0이라면 주문이 생성되지 않고 품절 알림
2. 생성되는 주문 정보
    - [배송지DB] - 배송지ID, 수령인 주소, 상세 주소, 수령인 이름, 수령인 연락처, 배송 요청사항
    - [주문상세DB] - 브랜드명[상품DB], 상품명[상품DB], 상품가격, 상품개수
    - [회원DB] - 회원ID
    - [주문DB] - 주문ID, 주문생성일, 주문상태, 총 배송비, 총 상품금액, 결제수단, 총 결제금액
        * 총 상품금액 = 주문 상품 종류만큼 {가격}*{개수} 의 합
        * 총 배송비 = 기본 배송비 + 추가 배송비
        * 총 배송비 계산 규칙
            - 사업자가 달라도 기본 배송비는 3천원으로 동일
            - 제주도 및 도서 산간 지역은 추가 배송비 3천원
            - 2만원 이상 주문시 배송비 무료(지역에 상관없이)
        * 총 결제금액 = 총 상품금액 + 총 배송비
        * 결제수단 종류
            - (신용/체크카드, 네이버페이, 카카오페이, 무통장 입금)
        * 주문상태 단계
            - [ 승인대기(WAITING) -> 주문승인(APPROVE) -> 배송완료(DELIVERED) -> 구매확정(CONFIRM) ]
            - [ 승인대기(WAITING) -> 주문취소(CANCEL) ]
        * 배송비 계산
            - 배송비는 외부 API를 이용하여 계산
        * 주문 ID 생성
            - 주문ID는 unique를 목적으로 암호화하여 생성해야 함( 주문생성시각 & 멤버ID 이용 )
        * enum 생성
            - 결제수단: CARD, KAKAOPAY, NAVERPAY
            - 주문상태: WAITING, APPROVE, DELIVERED, CONFIRM

### 주문 조회 설계안

1. 주문 조회
   1-1. 조회할 주문 정보
    - [배송지DB] - 배송지ID, 수령인 주소, 상세 주소, 수령인 이름, 수령인 연락처, 배송 요청사항
    - [주문상세DB] - 브랜드명[상품DB], 상품명[상품DB], 상품가격, 상품개수
    - [회원DB] - 회원ID
    - [주문DB] - 주문ID, 주문생성일, 주문상태, 총 배송비, 총 상품금액, 결제수단, 총 결제금액
    - (2차 스프린트) 배송 상태, 택배사 이름, 운송장 번호(택배사 이름과 운송장 번호는 판매자가 배송을 보내면 입력됨)
        * 배송상태 단계
            - [ 주문 승인 → 배송 준비중 → 배송중 → 배송 완료 ]

2. 구매 확정 시(구매자가 구매 확정을 하는 경우)
    - 주문상태가 'CONFIRM(구매확정)'으로 변경됨
      -> 상태의 변경 과정을 validation 해야함(APPROVE에서 바로 CONFIRM으로 넘어가지 않도록)
    - 반품 및 교환 불가

### 주문 취소 설계안

1. 주문 취소 조건 확인
    - 배송 상태가 [ 주문 승인 ] 상태일 경우만 주문 취소 가능
2. 주문 취소 신청
    - 회원이 주문 취소 사유 작성
3. 환불 시스템
    - 환불은 결제했던 수단으로 다시 환불
    - 영업일 기준 3~7일 이내에 처리
4. 주문 취소 완료
    - 주문 상태를 [ 주문 취소 ] 로 변경

### (판매자) 주문 관리 설계안

1. 승인된 주문 조회
2. 주문 취소 여부 결정
3. 주문 최종 승인시
    - 주문 상태가 [ 승인대기 ] 에서 [ 주문승인 ] 으로 변경됨
      // 4. 배송 준비중 단계가 필요할까?
4. 배송 시작(PATCH)
    - 판매자가 배송을 보냄 -> [배송DB]에서 배송ID 생성된 이후 ↓
    - [배송DB]에서 운송장 번호 생성, 택배사 생성
    - 배송상태를 [ 배송중 ]으로 변경
    - 배송상태가 [ 배송중 ]이 되면, 배송상태 조회 가능(처음엔 NULL)

### API 디자인

- 주문 생성: POST /v1/orders
    - 프로세스
        1. 주문 생성 유효성 검사
            - 주문 생성시 재고 수량이 0이라면 주문이 생성되지 않고, '품정된 상품입니다' 알림
        2. 주문 생성

- 주문 조회 : GET /v1/orders/{orderId}
  구매 확정: PATCH /v1/orders/{orderId}
    - 프로세스
        1. 주문 조회
        2. 구매 확정시(구매자가 구매 확정을 하는 경우)
            - 주문상태가 구매 확정이 됨(PATCH)
            - 반품 및 교환 불가

- 주문 취소 : PATCH /v1/orders/{orderId}
    - 프로세스
        1. 주문 취소 조건 확인
            - 배송상태가 [ 주문승인 ] 상태일 경우만 주문 취소 가능
        2. 주문 취소 신청
            - 회원이 주문 취소 사유 작성
        3. 환불
            - 결제했던 수단으로 환불 처리
            - 영업일 기준 3~7일 이내에 처리됨
        4. 주문 취소 완료
            - 주문 상태를 [ 주문취소 ]로 변경

- (판매자) 주문 관리 :
  승인 주문 조회: GET /v1/seller/orders/{orderId}
  주문 취소 여부 결정: PATCH /v1/seller/orders/{orderId}-cancel
  주문 최종 승인: PATCH /v1/seller/orders/{orderId}-approve
  배송 시작(배송상태 변경): PATCH /v1/seller/orders/{orderId}/delivery/
    - 프로세스
        1. 승인된 주문 조회(GET)
        2. 주문 취소 여부 결정(PATCH)
        3. 주문 최종 승인(PATCH)
            - 주문 상태가 [ 승인대기 ] 에서 [ 주문승인 ] 으로 변경됨
              // 4. 배송 준비중 단계가 필요할까?
        4. 배송 시작(PATCH)
            - 판매자가 배송을 보냄 -> [배송DB]에서 배송ID 생성된 이후 ↓
            - [배송DB]에서 운송장 번호 생성, 택배사 생성
            - 배송상태를 [ 배송중 ]으로 변경
            - 배송상태가 [ 배송중 ]이 되면, 배송상태 조회 가능(처음엔 NULL)